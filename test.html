<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDQ-4 — Тест</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <main class="container">
    <h1>PDQ-4</h1>
    <p id="progress"></p>
    <h2 id="questionText"></h2>

    <div class="answers">
      <button class="answer-btn yes" id="yesButton">Да</button>
      <button class="answer-btn no" id="noButton">Нет</button>
    </div>

    <div id="cityGroup" class="meta"></div>
  </main>

  <script type="module">
    import { calculateResults } from './js/calculateResults.js';

    const city = localStorage.getItem('city') || '—';
    const group = localStorage.getItem('group') || '—';
    document.getElementById('cityGroup').innerText = `${city} — Группа ${group}`;

    const progress = document.getElementById('progress');
    const questionText = document.getElementById('questionText');
    const yesBtn = document.getElementById('yesButton');
    const noBtn = document.getElementById('noButton');

    let current = 0;
    const answers = {};
    let questions = [];

    // ✅ Загружаем JSON через fetch (работает на GitHub Pages)
    fetch('data/questions.json')
      .then(res => res.json())
      .then(data => {
        questions = data;
        showQuestion();
      })
      .catch(err => {
        questionText.textContent = 'Ошибка загрузки вопросов: ' + err.message;
        document.querySelector('.answers').style.display = 'none';
      });

    function showQuestion() {
      const q = questions[current];
      progress.textContent = `Вопрос ${q.id} / ${questions.length}`;
      questionText.textContent = q.text;
    }

    function handleAnswer(isYes) {
      const q = questions[current];
      answers[q.id] = isYes;
      current++;

      if (current < questions.length) showQuestion();
      else showResultButton();
    }

    function showResultButton() {
      document.querySelector('.answers').innerHTML = `
        <button class="result-btn" id="showResult">Результат теста</button>
      `;
      document.getElementById('showResult').addEventListener('click', () => {
        localStorage.setItem('pdqResultsTemp', JSON.stringify(answers));
        const results = calculateResults(answers);
        localStorage.setItem('pdqResultsFinal', JSON.stringify(results));
        window.location.href = 'results.html';
      });
    }

    yesBtn.addEventListener('click', () => handleAnswer(true));
    noBtn.addEventListener('click', () => handleAnswer(false));
  </script>
</body>
</html>
